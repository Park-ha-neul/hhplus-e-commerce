title 사용자 상품 결제

사용자->결제: 사용자 상품 결제 요청 
activate 결제
결제->결제: 쿠폰 사용 여부 검증 (만료 검증)
alt 만료된 쿠폰을 사용하여 결제를 진행하는 경우
  결제-->사용자: 오류 응답 반환(만료된 쿠폰 사용 불가)
else 정상적 쿠폰을 사용하여 결제를 진행하는 경우
  결제->결제: 쿠폰을 적용한 금액 계산 
  결제->DB: 포인트 차감 업데이트
  activate DB
  DB-->결제: 포인트 차감 업데이트 완료
  결제->DB: 결제 데이터 저장/재고 업데이트
  DB-->결제: 결제 데이터 저장/재고 업데이트 완료
  deactivate DB
  alt 결제 데이터 저장 성공
    결제->외부 데이터 플랫폼: 실시간 주문 정보 전달 
    activate 외부 데이터 플랫폼
    결제-->사용자: 결제 완료 응답
    deactivate 외부 데이터 플랫폼
  else 결제 데이터 저장 실패
    결제-->사용자: 결제 실패 응답
    deactivate 결제
  end
end